name: Open Podcast and Log Screenshot

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  open-podcast:
    runs-on: macos-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Launch Podcasts
        run: |
          osascript -e 'tell application "Podcasts" to activate
          delay 10'
      
      - name: Screenshot After Launch
        run: screencapture step1_launch.png

      - name: Attempt to Press Enter Instead of Continue
        run: |
          osascript -e '
          tell application "System Events"
            tell process "Podcasts"
              try
                keystroke return
              end try
            end tell
          end tell
          delay 10
          '

      - name: Screenshot After Pop-up
        run: screencapture step2_popup.png

      - name: Open Desired Podcast Episode
        run: |
          osascript -e '
          tell application "Podcasts"
            open location "https://podcasts.apple.com/de/podcast/die-sogenannte-gegenwart/id1522895163?i=1000695431521"
            delay 10
          end tell
          '
      - name: Screenshot After Opening Episode
        run: screencapture step3_opened_episode.png

      - name: Scroll Down Instead of Command+T
        run: |
          osascript -e '
          tell application "System Events"
            key code 125
            delay 2
            key code 125
          end tell
          delay 10
          '
      - name: Screenshot After Transcript
        run: screencapture step4_transcript.png
      - name: Scroll Down Instead of Command+T
        run: |
          osascript -e '
          tell application "System Events"
            key code 125
            delay 2
            key code 125
          end tell
          delay 10
          '
      - name: Screenshot After Transcript
        run: screencapture step5_transcript.png
      - name: Scroll Down Instead of Command+T
        run: |
          osascript -e '
          tell application "System Events"
            key code 125
            delay 2
            key code 125
          end tell
          delay 10
          '
      - name: Screenshot After Transcript
        run: screencapture step6_transcript.png

      - name: Upload All Screenshots
        uses: actions/upload-artifact@v4
        with:
          name: screenshots
          path: |
            step1_launch.png
            step2_popup.png
            step3_opened_episode.png
            step4_transcript.png
            step5_transcript.png
            step6_transcript.png
